#!/bin/bash
input=$(cat)

MODEL=$(echo "$input" | jq -r '.model.display_name')
INPUT_TOKENS=$(echo "$input" | jq -r '.context_window.total_input_tokens')
OUTPUT_TOKENS=$(echo "$input" | jq -r '.context_window.total_output_tokens')
CONTEXT_SIZE=$(echo "$input" | jq -r '.context_window.context_window_size')

TOTAL=$((INPUT_TOKENS + OUTPUT_TOKENS))
PERCENT=$((TOTAL * 100 / CONTEXT_SIZE))
REMAINING=$((100 - PERCENT))

# Colors (using printf to create escape sequences)
RESET=$(printf '\033[00m')
GREEN=$(printf '\033[01;32m')
BLUE=$(printf '\033[01;34m')
MAGENTA=$(printf '\033[01;35m')
YELLOW=$(printf '\033[01;33m')
RED=$(printf '\033[01;31m')

# Context color based on remaining percentage
if [ "$REMAINING" -lt 10 ]; then
    CONTEXT_COLOR="$RED"
elif [ "$REMAINING" -lt 30 ]; then
    CONTEXT_COLOR="$YELLOW"
else
    CONTEXT_COLOR="$GREEN"
fi

# PS1-style: user@host:dir
PS1_PART="${GREEN}$(whoami)@$(hostname -s)${RESET}:${BLUE}$(basename "$(pwd)")${RESET}"

printf '%s %s[%s]%s %sContext:%s %s%s%%%s\n' "$PS1_PART" "$MAGENTA" "$MODEL" "$RESET" "$GREEN" "$RESET" "$CONTEXT_COLOR" "$REMAINING" "$RESET"
